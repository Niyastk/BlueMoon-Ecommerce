{% extends 'admin/adminBase.html' %}

{% block content %}

<section class="content-main">
  <div class="content-header">
    <h2 class="content-title">Coupon Management</h2>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="row">
        <div class="col-md-4">
          <form onsubmit=" return CheckForm()" action="{% url 'couponList' %}" method="POST">
            {% csrf_token %}
            <div class="mb-4">
              <label for="product_name" class="form-label">Minimum Purchase Rate</label>
              <input onchange="MinimumCheck()" type="number" placeholder="Type here" class="form-control" required
                name="purchase_rate" id="purchase_rate" />
            </div>
            <div class="mb-4">
              <label for="product_slug" class="form-label">Coupon Percentage</label>
              <input onchange="percentageCheck()" type="number" placeholder="Type here" class="form-control" required
                name="coupon_percentage" id="coupon_percentage" />
            </div>
            <div class="mb-4">
              <label class="form-label">Expiry Date</label>
              <input type="date" placeholder="Expiry date" class="form-control" required name="expiry_date"
                id="expiry_date" />
            </div>
            <div class="mb-4">
              <label class="form-label">Expiry Time</label>
              <input type="time" placeholder="Expiry date" class="form-control" required name="expiry_time"
                id="expiry_time" />
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">Create Offer</button>
            </div>
          </form>
        </div>
        <div class="col-md-8">
          <div class="col-search" style="padding-bottom: 30px;">
          </div>

          <table class="table table-hover">
            <thead>

              <tr>
                <th>Coupon Code</th>
                <th>Minimum Purchase Rate</th>
                <th>Percentage</th>
                <th>Expiry_date</th>
                <th>Expiry_time</th>
                <th class="text-end">Action</th>
              </tr>
            </thead>
            <tbody>
              {% for coupon in coupons %}
              <tr>
                <td><b>{{coupon.coupon_code}}</b></td>
                <td>{{coupon.minimum_rate}}</td>
                <td>{{coupon.percentage}}</td>
                <td>{{coupon.expiry_date}}</td>
                <td>{{coupon.expiry_time}}</td>
                <td class="text-end">
                  <div class="dropdown">
                    <a href="#" data-bs-toggle="dropdown" class="btn btn-light"> <i
                        class="material-icons md-more_horiz">...</i> </a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item" href="{% url 'couponEdit' coupon.id %}">Edit</a>
                      <a class="dropdown-item text-danger" href="{% url 'couponDelete' coupon.id %}"
                        onclick="return confirm('Are you want to delete?')">Delete</a>

                    </div>
                  </div>
                </td>
              </tr>


              {% endfor %}
            </tbody>
          </table>
        </div>
        <!-- .col// -->
      </div>
      <!-- .row // -->
    </div>
    <!-- card body .// -->
  </div>
  <!-- card .// -->
</section>
<!-- content-main end// -->

<script>
  function percentageCheck() {
    value = document.getElementById('coupon_percentage').value;
    if (value > 99) {
      alert("Offer cannot be more than 99")
      return false;
    } else if (value < 1) {
      alert("Offer cannot be less than 1 ")
      return false;
    }
  }
  function MinimumCheck() {
    value = document.getElementById('purchase_rate').value;
    if (value < 1) {
      alert("Value should be positive")
      return false;
    } else {
      return true;
    }
  }

  //date validation
  $(function () {

    var dtToday = new Date();

    var month = dtToday.getMonth() + 1;
    var day = dtToday.getDate() + 1;
    var year = dtToday.getFullYear();
    var time = dtToday.getHours() + ":" + dtToday.getMinutes();
    if (month < 10)

      month = '0' + month.toString();

    if (day < 10)

      day = '0' + day.toString();

    var maxDate = year + '-' + month + '-' + day

    console.log(maxDate);

    $('#expiry_date').attr('min', maxDate);


  });







  function CheckForm() {
    percentageCheck = percentageCheck()
    MinimumCheck = MinimumCheck()
    if (percentageCheck == true, MinimumCheck == true) {
      return true;
    } else {
      return false;
    }
  }
</script>

{% endblock %}